<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es"><head><title>Revista PHP - Enquete em PHP e MySQL</title>



	<meta name="resource-types" content="document">
	<meta http-equiv="pragma" content="no-cache">
	<meta name="revisit-after" content="1">
	<meta name="classification" content="Internet">
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<meta name="Description" content="Revista PHP é a primeira revista do Brasil criada para desenvolvedores PHP.">
	<meta name="Keywords" content=" php, php4, php5, php6, smart, phpeclipse,zend,zend2, java, sql, mysql, postgresql, oracle,oci, phpmagazine, javascript, css, XHTML HTML, tableless, revista, magazine, XML, postgres, Zend Framework">
	<meta name="robots" content="ALL">
	<meta name="distribution" content="Global">
	<meta name="ICBM" content="-20.2982,-40.3298">
	<meta name="DC.title" content="Revista PHP">
	<meta name="rating" content="General">
	<meta name="author" content="Revista PHP">
	<meta name="language" content="pt-br">
	<meta name="doc-class" content="Completed">

	<meta name="doc-rights" content="Public">
	<link rel="shortcut icon" href="http://www.revistaphp.com.br/ico/favicon.ico">
	

	<link rel="stylesheet" type="text/css" href="Enquete%20em%20PHP%20e%20MySQL_arquivos/artigos.css">

	<link rel="stylesheet" type="text/css" href="Enquete%20em%20PHP%20e%20MySQL_arquivos/artigo.css">

    <style type="text/css">
<!--
.style1 {color: #FF6600}
.style3 {color: #000033}
.style2 {color: #FF6600}
.style4 {color: #F0F0F0}
.style5 {color: #669900}
#Layer2 {
	position:absolute;
	left:16px;
	top:147px;
	width:565px;
	height:27px;
	z-index:2;
}

-->
    </style>
    <script type="text/JavaScript">
<!--
function MM_openBrWindow(theURL,winName,features) { //v2.0
  window.open(theURL,winName,features);
}
//-->
    </script><script charset="utf-8" id="injection_graph_func" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/injection_graph_func.js"></script></head><body>
	
	<div id="web">
<script>
//Verificar se a resolução vídeo for > 800 X 600
if(screen.width > 800)
{
	document.write ('<div style="display: block;" id="barradireita" >');
	document.write ('<div class="BarraBox" >');
	document.write ('<h2><a href="http://www.revistaphp.com.br/"><span>Revista PHP</span></a></h2>');
	document.write ('<ul><li>')
	document.write ('<iframe name="topo" width="160" height="600" src="barra1.php" framespacing="0" frameborder="no" scrolling="no"  allowtransparency="true" marginwidth="0" marginheight="0">')
	document.write ('</iframe>')
	document.write ('</li></ul>')
	document.write ('</div>');
	document.write ('</div>');
}

</script><div style="display: block;" id="barradireita"><div class="BarraBox"><h2><a href="http://www.revistaphp.com.br/"><span>Revista PHP</span></a></h2><ul><li><iframe name="topo" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/barra1.htm" framespacing="0" allowtransparency="true" marginwidth="0" marginheight="0" frameborder="no" height="600" scrolling="no" width="160"></iframe></li></ul></div></div> 
	 <div id="publicidade">
	  <a href="http://tehospedo.com.br/?xind=revistaphp.com.br" target="_blank"><img style="display: none;" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/banner_revistaPHP.gif" border="0" height="90" width="728"></a>
</div>
<div id="toporevista">
			<a href="http://www.revistaphp.com.br/index.php" id="logo"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/logo.gif" alt="Revista PHP" img="" border="0" height="93" width="246"></a>
			<a href="http://www.revistaphp.com.br/index.php" id="banner"><img style="display: none;" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/banner120.gif" alt="Revista PHP" onclick="MM_openBrWindow('upload.php','artigo','width=400,height=280')" img="" border="0" height="60" width="120"></a>

			<form method="get" action="artigos_resultado.php" name="form_search" id="buscador">
				Palavra:&nbsp;&nbsp;&nbsp; 
				<input name="p" size="38" maxlength="255" style="border: 1px solid rgb(153, 153, 153);" value="" id="sbi" class="form_search_input" type="text"><img title="Max field length is 255" style="border: 0pt none ; width: 14px; height: 19px; cursor: pointer;" class="ife_marker" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/marker.png" id="p_ife_marker_0" align="absmiddle">
				<label> <br>
				Categoria:
                <select name="c" class="form_search_select" id="c" style="border: 1px solid rgb(153, 153, 153); width: 120px;">

				  <option value="0">Selecione...</option>
<option value="6">Acessibilidade</option><option value="2">AJAX</option><option value="3">Banco de Dados</option><option value="4">CSS</option><option value="15">Frameworks</option><option value="13">GTK</option><option value="16">IDEs</option><option value="8">Java Script</option><option value="17">Miscelânea </option><option value="10">MySQL</option><option value="11">Oracle</option><option value="1">PHP</option><option value="14">Segurança</option><option value="7">Tableless </option><option value="12">Templates</option><option value="9">XHTML</option><option value="5">XML</option>	            </select>
				</label>
			  <label>
					<input name="buscar" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/btn-buscar.gif" type="image">
			  </label>
			</form>		
</div><div id="Destaque">
			<div id="Cabecalho">
 	<h2>Revista PHP  /  PHP</h2>
				
	            <ul class="submenu">
		<li class="texto"><strong>Publicado:  12/06/2007</strong></li>
        <li class="ultimo-lista"><a href="http://www.revistaphp.com.br/colaborador.php?cduser=1286"> Ver todos artigos</a></li>
</ul>
					<div id="DestaqueFundo">
					
		<div class="DestaqueTexto">
			<div>
   	
   <a href="http://www.revistaphp.com.br/colaborador.php?cduser=1286" class="imagem"><img class="imagem" src="Enquete%20em%20PHP%20e%20MySQL_arquivos/1286.jpg" title="Ândres Oliveira" border="0" height="75" width="65"></a>				
	<h3>Ândres Oliveira</h3>
	<p class="descricao-corta">Sou formado em Web Design, Possuo especialização em PHP e MySQL, já atuo na área de desenvolvimento de sites a mais de 3 anos.
Site: www.netcenterdesign.com.br</p>	
				
		  </div>		
		</div>			
		</div>			
	</div>
			
	  </div>
	  
		<div id="opcoes_artigos">
		  <div id="interacao">
		    <ul class="submenu"><script type="text/javascript"><!--
google_ad_client = "pub-1912416589418666";
google_ad_width = 728;
google_ad_height = 15;
google_ad_format = "728x15_0ads_al";
google_ad_channel = "";
google_color_border = "FFFFFF";
google_color_bg = "FFFFFF";
google_color_link = "006699";
google_color_text = "000000";
google_color_url = "008000";
//-->
</script>
<script style="display: none;" type="text/javascript" src="barra1_data/show_ads.js">
</script>
            </ul>
		  </div>
		</div>
		
		<div id="novidades-foro">
			<div id="novidades">
				<h2>Enquete em PHP e MySQL</h2>
			
		
				<div id="novidades-content">
			    <div class="descricao">
				<p>Realizaremos
uma simples enquete; porém muito funcional e sutil, utilizada em muitos
web sites como uma coleta de opiniões e preferências ante opções e uma
pergunta central. <br>
<br>
Para isso utilizaremos uma tabela de dados Mysql.<strong><o:p></o:p></strong></p>
<strong><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;,&quot;serif&quot;;">Estrutura da tabela</span></strong><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;,&quot;serif&quot;;">: </span><br style="">
<pre style="border: 1px solid rgb(208, 208, 208); color: rgb(0, 0, 102); background-color: rgb(240, 240, 240);" class="sql"><div class="head">SQL</div><ol><li class="li1"><div class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> <span class="st0">`enquete_blt`</span> <span class="br0">(</span> </div></li><li class="li1"><div class="de1"><span class="st0">`id_enquete`</span> varchar<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span> <span class="kw1">DEFAULT</span> <span class="st0">''</span>, </div></li><li class="li1"><div class="de1"><span class="st0">`id_opcao`</span> varchar<span class="br0">(</span><span class="nu0">5</span><span class="br0">)</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span> <span class="kw1">DEFAULT</span> <span class="st0">''</span>, </div></li><li class="li1"><div class="de1"><span class="st0">`ip`</span> varchar<span class="br0">(</span><span class="nu0">15</span><span class="br0">)</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span> <span class="kw1">DEFAULT</span> <span class="st0">''</span> <span class="br0">)</span> </div></li><li class="li2"><div class="de2">TYPE=MyISAM; </div></li></ol><div class="foot">www.revistaphp.com.br</div></pre>
<strong><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;,&quot;serif&quot;;">O código Fonte: </span></strong><span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;,&quot;serif&quot;;"><br>
enquete_blt.ini.php<br>
</span>
<pre style="border: 1px solid rgb(208, 208, 208); color: rgb(0, 0, 102); background-color: rgb(240, 240, 240);" class="php"><div class="head">PHP</div><ol><li class="li1"><div class="de1"><span class="kw2">&lt;?</span> </div></li><li class="li1"><div class="de1"><a href="http://www.php.net/mysql_connect" target="_blank"><span class="kw3">mysql_connect</span></a><span class="br0">(</span><span class="st0">'localhost'</span>,<span class="st0">'root'</span>,<span class="st0">''</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><span class="st0">'ERRO NA CONEXAO:'</span>.<a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><a href="http://www.php.net/mysql_select_db" target="_blank"><span class="kw3">mysql_select_db</span></a><span class="br0">(</span><span class="st0">'banco_de_dados_'</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><span class="st0">'ERRO AO ESCOLHER O BD :'</span>.<a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li2"><div class="de2"><span class="kw2">function</span> show_enquete<span class="br0">(</span><span class="re0">$id_ENQUETE</span>,<span class="re0">$protecao_IP</span><span class="br0">)</span><span class="br0">{</span> </div></li><li class="li1"><div class="de1"><span class="co1">// COLOCO TODAS MINHAS PERGUNTAS E OPCOES </span></div></li><li class="li1"><div class="de1"><span class="re0">$enquete</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>=<a href="http://www.php.net/array" target="_blank"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'Qual Tecnologia voce utiliza?'</span>,<a href="http://www.php.net/array" target="_blank"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'Php'</span>,<span class="st0">'Asp'</span>,<span class="st0">'ColdFusion'</span>,<span class="st0">'Cgi'</span>,<span class="st0">'Perl'</span>,<span class="st0">'Jsp'</span>,<span class="st0">'Otra'</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="co1">//END </span></div></li><li class="li1"><div class="de1"><span class="kw1">if</span> <span class="br0">(</span>!<a href="http://www.php.net/array_key_exists" target="_blank"><span class="kw3">array_key_exists</span></a><span class="br0">(</span><span class="re0">$id_ENQUETE</span>,<span class="re0">$enquete</span><span class="br0">)</span><span class="br0">)</span> <span class="kw1">return</span> <span class="br0">(</span><span class="st0">'O id da enquete nao se encontra disponivel'</span><span class="br0">)</span>; </div></li><li class="li2"><div class="de2"><span class="kw1">else</span> </div></li><li class="li1"><div class="de1"><span class="re0">$pergunta_da_enquete</span> = <a href="http://www.php.net/array_shift" target="_blank"><span class="kw3">array_shift</span></a><span class="br0">(</span><span class="re0">$enquete</span><span class="br0">[</span><span class="re0">$id_ENQUETE</span><span class="br0">]</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$opcoes_da_enquete</span> = <a href="http://www.php.net/array_pop" target="_blank"><span class="kw3">array_pop</span></a> <span class="br0">(</span><span class="re0">$enquete</span><span class="br0">[</span><span class="re0">$id_ENQUETE</span><span class="br0">]</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="kw1">if</span><span class="br0">(</span><a href="http://www.php.net/isset" target="_blank"><span class="kw3">isset</span></a><span class="br0">(</span><span class="re0">$_POST</span><span class="br0">[</span>opcao<span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="br0">{</span> </div></li><li class="li1"><div class="de1"><span class="re0">$ssqls</span>=<a href="http://www.php.net/mysql_query" target="_blank"><span class="kw3">mysql_query</span></a><span class="br0">(</span><span class="st0">'SELECT * FROM enquete_blt WHERE ip="'</span>.<span class="re0">$REMOTE_ADDR</span>.<span class="st0">'"'</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li2"><div class="de2"><span class="kw1">if</span><span class="br0">(</span><span class="re0">$protecao_IP</span> &amp;&amp; <a href="http://www.php.net/mysql_num_rows" target="_blank"><span class="kw3">mysql_num_rows</span></a><span class="br0">(</span><span class="re0">$ssqls</span><span class="br0">)</span>&gt;=<span class="nu0">1</span><span class="br0">)</span><span class="br0">{</span> </div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>=<span class="st0">'&lt;font color="#FF0000" face="tahoma" size="2"&gt;&lt;strong&gt;Voce ja tem um voto registrado&lt;/strong&gt;o &lt;/font&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="br0">}</span> </div></li><li class="li1"><div class="de1"><span class="kw1">else</span> <span class="br0">{</span><a href="http://www.php.net/mysql_query" target="_blank"><span class="kw3">mysql_query</span></a><span class="br0">(</span><span class="st0">'INSERT INTO enquete_blt VALUES("'</span>.<span class="re0">$id_ENQUETE</span>.<span class="st0">'","'</span>.<span class="re0">$_POST</span><span class="br0">[</span>opcao<span class="br0">]</span>.<span class="st0">'","'</span>.<span class="re0">$REMOTE_ADDR</span>.<span class="st0">'")'</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; <span class="br0">}</span> </div></li><li class="li1"><div class="de1"><span class="br0">}</span> </div></li><li class="li2"><div class="de2">&nbsp;</div></li><li class="li1"><div class="de1"><span class="re0">$ssql</span>=<a href="http://www.php.net/mysql_query" target="_blank"><span class="kw3">mysql_query</span></a><span class="br0">(</span><span class="st0">'SELECT * FROM enquete_blt WHERE id_enquete="'</span>.<span class="re0">$id_ENQUETE</span>.<span class="st0">'"'</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$total_votos</span>=<a href="http://www.php.net/mysql_num_rows" target="_blank"><span class="kw3">mysql_num_rows</span></a><span class="br0">(</span><span class="re0">$ssql</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">// IMPRIMIR OS RESULTADOS. </span></div></li><li class="li2"><div class="de2"><span class="re0">$html_enquete</span>.=<span class="st0">'&lt;form action="'</span>.<span class="re0">$_SERVER</span><span class="br0">[</span>REQUEST_URI<span class="br0">]</span>.<span class="st0">'" method="POST"&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>.= <span class="st0">'&lt;strong&gt;'</span>.<span class="re0">$pergunta_da_enquete</span>.<span class="st0">'&lt;/strong&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>.=<span class="st0">'&lt;br&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="kw1">foreach</span><span class="br0">(</span><span class="re0">$opcoes_da_enquete</span> <span class="kw1">as</span> <span class="re0">$KEY</span> =&gt; <span class="re0">$OPCAO</span><span class="br0">)</span><span class="br0">{</span> </div></li><li class="li1"><div class="de1"><span class="re0">$ssql</span>=<a href="http://www.php.net/mysql_query" target="_blank"><span class="kw3">mysql_query</span></a><span class="br0">(</span><span class="st0">'SELECT * FROM enquete_blt WHERE id_enquete="'</span>.<span class="re0">$id_ENQUETE</span>.<span class="st0">'" and id_opcao="'</span>.<span class="re0">$KEY</span>.<span class="st0">'"'</span><span class="br0">)</span>or <a href="http://www.php.net/die" target="_blank"><span class="kw3">die</span></a><span class="br0">(</span><a href="http://www.php.net/mysql_error" target="_blank"><span class="kw3">mysql_error</span></a><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span>; </div></li><li class="li2"><div class="de2"><span class="re0">$votos_x_opcao</span>=<a href="http://www.php.net/mysql_num_rows" target="_blank"><span class="kw3">mysql_num_rows</span></a><span class="br0">(</span><span class="re0">$ssql</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$estimar_porcentagem</span>= @<a href="http://www.php.net/round" target="_blank"><span class="kw3">round</span></a><span class="br0">(</span><span class="re0">$votos_x_opcao</span>*<span class="nu0">100</span>/<span class="re0">$total_votos</span>,<span class="nu0">1</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>.= <span class="st0">'&lt;input name="opcao" type="radio" value="'</span>.<span class="re0">$KEY</span>.<span class="st0">'"'</span>; </div></li><li class="li1"><div class="de1"><span class="kw1">if</span><span class="br0">(</span><span class="re0">$_POST</span><span class="br0">[</span>opcao<span class="br0">]</span>==<span class="re0">$KEY</span> &amp;&amp; <a href="http://www.php.net/isset" target="_blank"><span class="kw3">isset</span></a><span class="br0">(</span><span class="re0">$_POST</span><span class="br0">[</span>opcao<span class="br0">]</span><span class="br0">)</span><span class="br0">)</span><span class="br0">{</span><span class="re0">$html_enquete</span>.=<span class="st0">'checked'</span>; <span class="br0">}</span> </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li2"><div class="de2"><span class="re0">$html_enquete</span>.= <span class="st0">'&gt;'</span>.<span class="re0">$OPCAO</span>.<span class="st0">' '</span>.<span class="re0">$estimar_porcentagem</span>.<span class="st0">'% &lt;strong&gt;Votos: '</span>.<span class="re0">$votos_x_opcao</span>.<span class="st0">'&lt;/strong&gt; &lt;br&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="br0">}</span> </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>.=<span class="st0">'&lt;br&gt;&lt;input type="submit" value="Votar"&gt;'</span>; </div></li><li class="li1"><div class="de1"><span class="re0">$html_enquete</span>.=<span class="st0">'&lt;/form&gt;'</span>; </div></li><li class="li2"><div class="de2"><span class="kw1">return</span> <span class="re0">$html_enquete</span>; </div></li><li class="li1"><div class="de1"><span class="br0">}</span> </div></li><li class="li1"><div class="de1"><span class="kw2">?&gt;</span> </div></li></ol><div class="foot">www.revistaphp.com.br</div></pre>
<p><strong>Explicação do código</strong> </p>
<p>Antes que nada, como de costume criaremos a conexão com o servidor
Mysql e selecionaremos o banco de dados com o qual trabalharemos. <br>
<br>
Definiremos uma função com o nome de show_enquete($id_enquete,
$protecao_IP), onde $id_enquete, se refere ao identificador da enquete
que utilizaremos. Este sistema está adaptado para suportar um sem fim
de enquetes, e $protecao_IP cujo valor deve ser sempre um booleano
(TRUE ou FALSE) e é o encarregado de não permitir que um usuário vote
mais de uma vez, utilizando seu endereço IP como referência. <br>
<br>
Associamos em um array multidimencional o conteúdo de nossa enquete: <br>
<br>
</p>
<pre style="border: 1px solid rgb(208, 208, 208); color: rgb(0, 0, 102); background-color: rgb(240, 240, 240);" class="php"><div class="head">PHP</div><ol><li class="li1"><div class="de1"><span class="re0">$enquete</span><span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span>=<a href="http://www.php.net/array" target="_blank"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'Pergunta '</span>,<a href="http://www.php.net/array" target="_blank"><span class="kw3">array</span></a><span class="br0">(</span><span class="st0">'A'</span>,<span class="st0">'B'</span>,<span class="st0">'C'</span>,<span class="st0">'D'</span>,<span class="st0">'E'</span>,<span class="st0">'&#8230;'</span>,<span class="br0">)</span><span class="br0">)</span>; </div></li></ol><div class="foot">www.revistaphp.com.br</div></pre>
<p> <br>
Onde 1, é o identificador de nossa enquete, se quisermos inserir uma
nova pergunta utilizaremos $enquete [2] e assim sucessivamente seguindo
o esquema, em ordem ascendente, cabe destacar que não podemos repetir o
valor numérico, já que mudaríamos o conteúdo por este último. Pergunta,
é a pergunta central da enquete e A,B,C,D,E,&#8230; são as opções a escolher
pelos usuários. Podemos utilizar um sem fim de opções sempre e quando
sigamos o esquema. <br>
<br>
Logo, utilizamos a função array_key_exists(), para verificar que existe
o identificador da enquete, esta função comprova se existe o índice ou
a chave de um array. Colocamos o (!) ao começo para indicar se a
condição da função anterior devolve FALSE, para retornar uma mensagem
de erro; return ('O id da enquete nao&#8230;); <br>
<br>
Agruparemos na variável $pergunta_da_enquete, o primeiro valor da
matriz $enquete[$id_ENQUETE] com a função array_shift(), o que seria
praticamente o mesmo utilizando $enquete[$id_ENQUETE][0]., porém, neste
caso usamos uma função definida em PHP para este rol; como é o caso de
array_pop(), que nos extrai o último valor da matriz
$enqueta[$id_ENQUETE], que seria por sua vez outra matriz ou array com
todas nossas opções da pergunta: array('A','B','C','D','E','&#8230;',) <br>
<br>
Comprovaremos se $_POST[opcao] está definida ou toma algum valor, onde
opção, é o nome do botão de OPCAO ou Radio. Se esta condição avalia
TRUE, indica que alguma opção foi clicada e foi processado o
formulário. <br>
<br>
Para executar as seguintes instruções: <br>
<br>
Enviaremos uma petição ao servidor Mysql com mysql_query(consulta&#8230;)
para obter todos os registros onde coincidem a fila IP, com o endereço
IP do cliente $REMOTE_ADDR, utilizando a cláusula WHERE. Logo,
iniciamos uma nova condição, agora indicando se $protecao_IP é TRUE e
(Lógico &amp;&amp;) o total de registros da consulta anterior é igual
ou maior a 1. Para gerar uma mensagem de erro e impedir o registro do
novo voto. <br>
<br>
<strong> Algo como: </strong><br>
Meu IP é: 127.0.0.1 <br>
<br>
Executo a consulta Mysql e me indica que esse IP já está registrado em um voto anterior. <br>
O valor que atribui a $protecao_IP quando chamar minha função é TRUE . <br>
Então estes dois valores são VERDADEIROS. E o programa me responde bye, bye, bye. Você já votou&#8230; <br>
<br>
Se $protecao_IP for FALSE, então posso votar um montão de vezes mesmo estando registrado o IP <br>
<br>
Do contrário ( else ) <br>
Insere-se um novo registro com dados essenciais para o funcionamento desta enquete. <br>
<br>
Fim do else <br>
<br>
A partir deste ponto trabalharemos sem importar se está definida ou não $_POST[opcao]. <br>
<br>
Realizando uma nova consulta a Mysql, para obter o total de registro
correspondente à enquete que está correndo. Para utilizar este valor no
cálculo da porcentagem de cada opção. <br>
<br>
$html_enquete, esta variável conterá o resultado que se imprimirá em
tela, por isso usam-se conectores (.=) e seu conteúdo são etiquetas de
HTML, com o formulário e os demais textos. <br>
<br>
Utilizamos o prático loop FOREACH, para fazer um percorrido rápido de
todas as opções (a,b,c,d,..) onde obteremos o valor do $KEY ou Chave e
o nome da $OPCAO. <br>
<br>
Voltaremos a realizar uma consulta para buscar agora todos os votos dessa opção e dessa enquete. Obtemos o total de registros. <br>
<br>
Para logo com a função round() arredondar o valor de
($votos_x_opcao*100/$total_votos) com 1 decimal. Onde $votos_x_opcao
são todos os votos por essa opção e $total_votos o total de votos por
toda a enquete. <br>
<br>
O mesmo processo empregado para obter qualquer porcentagem, colocamos o
(@) para evitar que se mostre um erro por acaso $total_votos eh == a 0
( ZERO) <br>
<br>
Finalmente com return, retornamos o conteúdo de $html_enquete; <br>
<br>
Para chamar a função executamos o seguinte: </p>
<pre style="border: 1px solid rgb(208, 208, 208); color: rgb(0, 0, 102); background-color: rgb(240, 240, 240);" class="php"><div class="head">PHP</div><ol><li class="li1"><div class="de1"><span class="kw2">&lt;?</span> </div></li><li class="li1"><div class="de1"><span class="kw1">include</span><span class="br0">(</span><span class="st0">'enquete_blt.ini.php'</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><a href="http://www.php.net/echo" target="_blank"><span class="kw3">echo</span></a> show_enquete<span class="br0">(</span><span class="nu0">1</span>,<span class="kw2">true</span><span class="br0">)</span>; </div></li><li class="li1"><div class="de1"><span class="kw2">?&gt;</span> </div></li></ol><div class="foot">www.revistaphp.com.br</div></pre>
Ãbraço e até a próxima.<br>
<span style="font-size: 12pt; font-family: &quot;Times New Roman&quot;,&quot;serif&quot;;"></span> </div></div>																																																																										
			</div>
			
		</div>
		
		
		<div id="opcoes_artigos">
		  <div id="interacao">
				<h2 align="left">Opções de Interação </h2>
				
                <div align="center">
                  <ul class="submenu">	
                            <div align="left"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/comentar.gif" style="cursor: pointer;" title="Comentar" onclick="MM_openBrWindow('pop_comentar.php?id=137','comentario','width=420,height=220')" height="21" width="100">
                              <span class="activa"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/colunista.gif" onclick="MM_openBrWindow('popups/colunista.php?c=1286','colunista','width=400,height=200')" title="Fale com o colunista" style="cursor: pointer;" height="21" width="165"> </span><span class="activa"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/indicar.gif" onclick="MM_openBrWindow('popups/indicacao.php?id=137','colunista','width=400,height=200')" title="Indicar artigo" height="21" width="120"></span> <a href="http://www.revistaphp.com.br/print.php?id=137" target="_blank"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/imprimir.gif" style="cursor: pointer;" title="Versão de impressão" height="21" width="90"></a> <a href="http://groups.google.com.br/group/listaphp" target="_blank"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/duvidas.gif" title="Lista PHP Google" height="21" width="90"></a> 
							   
							   <img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/favoritos.gif" style="cursor: pointer;" title="Adicionar aos Favoritos" onclick="MM_openBrWindow('pop_favoritos.php?id=137&acao=add','favoritos','width=420,height=220')" height="21" width="150">
							  							  </div>
                            <li class="activa"></li>
<li class="activa">&nbsp;</li>
</ul>
            </div>
              <ul class="submenu">
            </ul>
		  </div>
		</div>
	<div id="novidades-foro">
			<div id="novidades">
				<h2>Comentários</h2>
				
	            <ul class="submenu">	
		<li class="activa"><a style="cursor: pointer;" onclick="MM_openBrWindow('pop_comentar.php?id=137','comentario','width=420,height=220')">Incluir Comentário  </a></li>
<li class="ultimo-lista"><a href="#"> Ver todos </a></li>
<li class="activa"></li></ul>
		
				<div id="novidades-content">
			    <div class="descricao">
				  </div>
				</div>																																																																										
			</div>
			
	  </div>
	  <div id="final"><a href="http://www.revistaphp.com.br/index.php"><img src="Enquete%20em%20PHP%20e%20MySQL_arquivos/logo.gif" border="0" height="93" width="246"></a>
</div>
		
</div>
	<script src="Enquete%20em%20PHP%20e%20MySQL_arquivos/urchin.js" type="text/javascript"></script>
	<script type="text/javascript">
		_uacct = "UA-313498-1";
		urchinTracker();
	</script>
</body></html>